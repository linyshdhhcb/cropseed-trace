# æ¨èç³»ç»Ÿå®ç°æ–‡æ¡£ (v2.0)

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 æ¶æ„è®¾è®¡
æœ¬æ¨èç³»ç»Ÿé‡‡ç”¨**æ··åˆæ¨èæ¶æ„**ï¼Œå®ç°äº†çœŸæ­£çš„å¤šç®—æ³•èåˆç­–ç•¥ï¼š
- **ååŒè¿‡æ»¤æ¨è** (30%æƒé‡) - åŸºäºç”¨æˆ·ç›¸ä¼¼åº¦çš„ååŒè¿‡æ»¤
- **å†…å®¹æ¨è** (25%æƒé‡) - åŸºäºå•†å“ç‰¹å¾ç›¸ä¼¼æ€§æ¨è
- **ä¸ªæ€§åŒ–æ¨è** (25%æƒé‡) - åŸºäºç”¨æˆ·ç”»åƒçš„ä¸ªæ€§åŒ–æ¨è
- **çƒ­é—¨æ¨è** (20%æƒé‡) - åŸºäºå¸‚åœºçƒ­åº¦çš„æ¨è

### 1.2 æŠ€æœ¯å®ç°æ ¸å¿ƒ

####  **ç®—æ³•é€»è¾‘**
- **çœŸæ­£çš„æ··åˆæ¨è**: å®ç°åŠ æƒèåˆè€Œéç®€å•é€‰æ‹©ï¼Œè§£å†³æ ¸å¿ƒé€»è¾‘é”™è¯¯
- **æ™ºèƒ½é™æƒ**: å¯¹æœ€è¿‘è´­ä¹°å•†å“é™æƒè€Œéå®Œå…¨è¿‡æ»¤ï¼Œæé«˜æ¨èå¤šæ ·æ€§
- **é…ç½®åŒ–ç®—æ³•**: æ‰€æœ‰ç®—æ³•å‚æ•°å¯é…ç½®ï¼Œä¾¿äºç”Ÿäº§ç¯å¢ƒè°ƒä¼˜

#### ğŸ›¡ï¸ **å¥å£®æ€§å¢å¼º**
- **å‚æ•°æ ¡éªŒ**: å…¨é¢çš„è¾¹ç•Œæ¡ä»¶æ£€æŸ¥
- **æ—¥å¿—å¢å¼º**: è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—å’Œæ€§èƒ½ç›‘æ§
- **å®¹é”™è®¾è®¡**: å•ä¸ªç®—æ³•å¤±è´¥ä¸å½±å“æ•´ä½“æ¨è

## 2. æ•°æ®æ¨¡å‹ä¸é…ç½®

### 2.1 ç”¨æˆ·è¡Œä¸ºè¡¨ (user_behavior)
```sql
CREATE TABLE user_behavior (
    id BIGINT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    behavior_type INT NOT NULL COMMENT '1-æµè§ˆ,2-æœç´¢,3-æ”¶è—,4-åŠ è´­ç‰©è½¦,5-è´­ä¹°,6-è¯„ä»·',
    target_type INT DEFAULT 1 COMMENT 'ç›®æ ‡ç±»å‹:1-å•†å“',
    target_id BIGINT NOT NULL COMMENT 'ç›®æ ‡ID',
    behavior_content TEXT COMMENT 'è¡Œä¸ºå†…å®¹',
    behavior_weight DECIMAL(3,2) DEFAULT 1.0 COMMENT 'è¡Œä¸ºæƒé‡',
    rating INT COMMENT 'è¯„åˆ†(1-5)',
    behavior_time DATETIME NOT NULL,
    session_id VARCHAR(64) COMMENT 'ä¼šè¯ID',
    deleted_flag TINYINT DEFAULT 0
);
```

### 2.2 ç”¨æˆ·ç”»åƒè¡¨ (user_profile)
```sql
CREATE TABLE user_profile (
    id BIGINT PRIMARY KEY,
    user_id BIGINT NOT NULL UNIQUE,
    user_type INT DEFAULT 1 COMMENT 'ç”¨æˆ·ç±»å‹:1-ä¸ªäºº,2-ä¼ä¸š',
    region VARCHAR(100) COMMENT 'åœ°åŒº',
    activity_level DECIMAL(3,2) COMMENT 'æ´»è·ƒåº¦(0-1)',
    purchase_frequency DECIMAL(3,2) COMMENT 'è´­ä¹°é¢‘ç‡(0-1)',
    price_sensitivity DECIMAL(3,2) COMMENT 'ä»·æ ¼æ•æ„Ÿåº¦(0-1)',
    quality_requirement DECIMAL(3,2) COMMENT 'è´¨é‡è¦æ±‚(0-1)',
    brand_loyalty DECIMAL(3,2) COMMENT 'å“ç‰Œå¿ è¯šåº¦(0-1)',
    purchase_preference VARCHAR(200) COMMENT 'è´­ä¹°åå¥½',
    recommendation_weight DECIMAL(3,2) DEFAULT 1.0 COMMENT 'æ¨èæƒé‡'
);
```

### 2.3 å•†å“ç‰¹å¾è¡¨ (seed_features)
```sql
CREATE TABLE seed_features (
    id BIGINT PRIMARY KEY,
    seed_id BIGINT NOT NULL UNIQUE,
    price_feature DECIMAL(3,2) COMMENT 'ä»·æ ¼ç‰¹å¾',
    quality_feature DECIMAL(3,2) COMMENT 'è´¨é‡ç‰¹å¾', 
    brand_feature DECIMAL(3,2) COMMENT 'å“ç‰Œç‰¹å¾',
    market_heat DECIMAL(3,2) COMMENT 'å¸‚åœºçƒ­åº¦',
    user_rating DECIMAL(3,2) COMMENT 'ç”¨æˆ·è¯„åˆ†',
    recommendation_weight DECIMAL(3,2) DEFAULT 1.0
);
```

## 3. æ¨èç®—æ³•æ•°å­¦å…¬å¼

### 3.1 ååŒè¿‡æ»¤ç®—æ³•æ•°å­¦æ¨¡å‹

#### 3.1.1 ç”¨æˆ·ç›¸ä¼¼åº¦è®¡ç®—

**ä½™å¼¦ç›¸ä¼¼åº¦å…¬å¼ï¼š**
$$
sim(u,v) = cos(Î¸) = (Ru Â· Rv) / (||Ru|| Ã— ||Rv||)
$$
å…¶ä¸­ï¼š
- Ru, Rv åˆ†åˆ«è¡¨ç¤ºç”¨æˆ·uå’Œç”¨æˆ·vçš„è¯„åˆ†å‘é‡
- Ru Â· Rv è¡¨ç¤ºå‘é‡ç‚¹ç§¯ï¼šÎ£(Rui Ã— Rvi)
- ||Ru|| è¡¨ç¤ºå‘é‡æ¨¡é•¿ï¼šâˆš(Î£(RuiÂ²))

**ç»¼åˆç›¸ä¼¼åº¦å…¬å¼ï¼š**
$$
SimTotal(u,v) = Î± Ã— SimBehavior(u,v) + Î² Ã— SimProfile(u,v)
$$
å…¶ä¸­ï¼š
- Î± = 0.7 (è¡Œä¸ºç›¸ä¼¼åº¦æƒé‡)
- Î² = 0.3 (ç”»åƒç›¸ä¼¼åº¦æƒé‡)
- Î± + Î² = 1

**ç”¨æˆ·ç”»åƒç›¸ä¼¼åº¦ï¼š**
$$
SimProfile(u,v) = (1/n) Ã— Î£[similarity_factor_i]

similarity_factor_i = {
    0.3, if userType(u) = userType(v)
    0.2, if region(u) = region(v)  
    0.2 Ã— (1 - |priceSensitivity(u) - priceSensitivity(v)|)
    0.2 Ã— (1 - |qualityRequirement(u) - qualityRequirement(v)|)
    0.1, if purchasePreference(u) = purchasePreference(v)
}
$$

#### 3.1.2 éšå¼è¯„åˆ†è®¡ç®—

**è¡Œä¸ºè¯„åˆ†å…¬å¼ï¼š**
$$
Rating(u,i) = Î£[BaseScore(type) Ã— Weight(behavior) Ã— TimeDecay(t)]
$$
å…¶ä¸­ï¼š
BaseScore(type) = {
    1.0,  type = 1 (æµè§ˆ)
    1.5,  type = 2 (æœç´¢)
    3.0,  type = 3 (æ”¶è—)
    3.5,  type = 4 (åŠ è´­ç‰©è½¦)
    5.0,  type = 5 (è´­ä¹°)
    4.0,  type = 6 (è¯„ä»·)
}

**æ—¶é—´è¡°å‡å‡½æ•°ï¼š**
$$
TimeDecay(t) = {
    1.0,  if Î”t â‰¤ 30å¤©
    0.8,  if 30å¤© < Î”t â‰¤ 60å¤©
    0.6,  if 60å¤© < Î”t â‰¤ 90å¤©
    0.4,  if 90å¤© < Î”t â‰¤ 180å¤©
    0.2,  if Î”t > 180å¤©
}
$$
å…¶ä¸­ Î”t = current_time - behavior_time

#### 3.1.3 ååŒè¿‡æ»¤é¢„æµ‹è¯„åˆ†

**é¢„æµ‹è¯„åˆ†å…¬å¼ï¼š**
$$
P(u,i) = Î£[sim(u,v) Ã— Rating(v,i)] / Î£|sim(u,v)|
$$
å…¶ä¸­ï¼š
- P(u,i) è¡¨ç¤ºç”¨æˆ·uå¯¹å•†å“içš„é¢„æµ‹è¯„åˆ†
- sim(u,v) è¡¨ç¤ºç”¨æˆ·uä¸ç”¨æˆ·vçš„ç›¸ä¼¼åº¦
- Rating(v,i) è¡¨ç¤ºç”¨æˆ·vå¯¹å•†å“içš„å®é™…è¯„åˆ†
- æ±‚å’ŒèŒƒå›´ä¸ºæ‰€æœ‰ä¸ç”¨æˆ·uç›¸ä¼¼ä¸”å¯¹å•†å“iæœ‰è¡Œä¸ºçš„ç”¨æˆ·v

**é™æƒå¤„ç†ï¼š**
$$
P'(u,i) = {
    P(u,i) Ã— 0.3,  if i âˆˆ RecentPurchased(u)
    P(u,i),        otherwise
}

RecentPurchased(u) = {i | ç”¨æˆ·uåœ¨è¿‡å»30å¤©å†…è´­ä¹°è¿‡å•†å“i}
$$


### 3.2 å†…å®¹æ¨èç®—æ³•æ•°å­¦æ¨¡å‹

#### 3.2.1 å•†å“ç‰¹å¾å‘é‡

**å•†å“ç‰¹å¾è¡¨ç¤ºï¼š**
$$
Item(i) = [price_feature, quality_feature, brand_feature, market_heat, user_rating]
$$
å…¶ä¸­æ¯ä¸ªç‰¹å¾å€¼èŒƒå›´ä¸º [0, 1]

**ç‰¹å¾ç›¸ä¼¼åº¦è®¡ç®—ï¼š**
$$
ContentSim(i,j) = cos(Item(i), Item(j)) = (Item(i) Â· Item(j)) / (||Item(i)|| Ã— ||Item(j)||)
$$

#### 3.2.2 ç”¨æˆ·åå¥½å»ºæ¨¡

**ç”¨æˆ·åå¥½å‘é‡ï¼š**
$$
UserPref(u) = Î£[Rating(u,i) Ã— Item(i)] / Î£[Rating(u,i)]
$$
å…¶ä¸­æ±‚å’ŒèŒƒå›´ä¸ºç”¨æˆ·uæœ‰è¡Œä¸ºçš„æ‰€æœ‰å•†å“i

**å†…å®¹æ¨èè¯„åˆ†ï¼š**
$$
ContentScore(u,i) = UserPref(u) Â· Item(i)
$$


### 3.3 ä¸ªæ€§åŒ–æ¨èæ•°å­¦æ¨¡å‹

#### 3.3.1 ç”¨æˆ·ç”»åƒæŒ‡æ ‡è®¡ç®—

**æ´»è·ƒåº¦è®¡ç®—ï¼š**
$$
ActivityLevel(u) = min(RecentBehaviorCount(u) / 30, 1.0)

RecentBehaviorCount(u) = |{b | b âˆˆ Behaviors(u) âˆ§ time(b) > current_time - 30å¤©}|
$$
**è´­ä¹°é¢‘ç‡è®¡ç®—ï¼š**
$$
PurchaseFrequency(u) = min(PurchaseCount(u) / 10, 1.0)

PurchaseCount(u) = |{b | b âˆˆ Behaviors(u) âˆ§ type(b) = 5}|
$$
**ä»·æ ¼æ•æ„Ÿåº¦è®¡ç®—ï¼š**
$$
PriceSensitivity(u) = max(0, min(1, (MaxPrice - AvgPurchasePrice(u)) / MaxPrice))

AvgPurchasePrice(u) = (Î£ price(i)) / |PurchasedItems(u)|
$$
å…¶ä¸­ MaxPrice = 200 (å‡è®¾çš„æœ€é«˜ä»·æ ¼)

**è´¨é‡è¦æ±‚è®¡ç®—ï¼š**
$$
QualityRequirement(u) = AvgRating(u) / 5.0

AvgRating(u) = (Î£ rating(u,i)) / |RatedItems(u)|
$$


#### 3.3.2 ä¸ªæ€§åŒ–è¯„åˆ†

**åŸºäºä»·æ ¼çš„è¯„åˆ†ï¼š**
$$
PriceScore(u,i) = {
    1.0,  if PriceSensitivity(u) > 0.7 âˆ§ price(i) < 0.3 Ã— MaxPrice
    0.0,  otherwise
}
$$
**åŸºäºè´¨é‡çš„è¯„åˆ†ï¼š**
$$
QualityScore(u,i) = {
    quality_feature(i),  if QualityRequirement(u) > 0.7
    0.0,                 otherwise
}
$$


### 3.4 æ··åˆæ¨èæ•°å­¦æ¨¡å‹

#### 3.4.1 åŠ æƒèåˆå…¬å¼

**æ··åˆè¯„åˆ†è®¡ç®—ï¼š**
$$
HybridScore(u,i) = wâ‚Ã—CF_Score(u,i) + wâ‚‚Ã—Content_Score(u,i) + wâ‚ƒÃ—Personal_Score(u,i) + wâ‚„Ã—Popular_Score(i)
$$
å…¶ä¸­æƒé‡åˆ†é…ï¼š
wâ‚ = 0.30 (ååŒè¿‡æ»¤æƒé‡)
wâ‚‚ = 0.25 (å†…å®¹æ¨èæƒé‡)  
wâ‚ƒ = 0.25 (ä¸ªæ€§åŒ–æ¨èæƒé‡)
wâ‚„ = 0.20 (çƒ­é—¨æ¨èæƒé‡)

çº¦æŸæ¡ä»¶ï¼šwâ‚ + wâ‚‚ + wâ‚ƒ + wâ‚„ = 1.0

#### 3.4.2 æœ€ç»ˆæ’åº

**å½’ä¸€åŒ–å¤„ç†ï¼š**
$$
NormalizedScore(u,i) = (HybridScore(u,i) - min_score) / (max_score - min_score)
$$
å…¶ä¸­ï¼š
min_score = min{HybridScore(u,j) | j âˆˆ CandidateItems}
max_score = max{HybridScore(u,j) | j âˆˆ CandidateItems}

**Top-Næ¨èï¼š**
$$
Recommendations(u,N) = TopN{(i, NormalizedScore(u,i)) | i âˆˆ CandidateItems}
$$
æŒ‰ NormalizedScore(u,i) é™åºæ’åˆ—ï¼Œå–å‰Nä¸ªå•†å“

### 3.5 è¯„ä¼°æŒ‡æ ‡æ•°å­¦å…¬å¼

#### 3.5.1 å‡†ç¡®æ€§æŒ‡æ ‡

**ç²¾ç¡®ç‡ (Precision)ï¼š**
$$
Precision@N = |RelevantItems âˆ© RecommendedItems| / |RecommendedItems|
$$
å…¶ä¸­ N ä¸ºæ¨èåˆ—è¡¨é•¿åº¦

**å¬å›ç‡ (Recall)ï¼š**
$$
Recall@N = |RelevantItems âˆ© RecommendedItems| / |RelevantItems|
$$
**F1åˆ†æ•°ï¼š**
$$
F1@N = 2 Ã— (Precision@N Ã— Recall@N) / (Precision@N + Recall@N)
$$


#### 3.5.2 å¤šæ ·æ€§æŒ‡æ ‡

**æ¨èå¤šæ ·æ€§ï¼š**
$$
Diversity = (1 / (NÃ—(N-1))) Ã— Î£Î£(1 - sim(i,j))
           i=1 j=i+1
$$
å…¶ä¸­ sim(i,j) ä¸ºå•†å“iå’Œå•†å“jçš„ç›¸ä¼¼åº¦

#### 3.5.3 è¦†ç›–ç‡æŒ‡æ ‡

**ç›®å½•è¦†ç›–ç‡ï¼š**
```java
@Override
public List<RecommendationVO> collaborativeFilteringRecommend(Long userId, Integer limit) {
    try {
        // 1. è·å–ç”¨æˆ·ç”»åƒå’Œè¡Œä¸ºæ•°æ®
        UserProfile userProfile = userProfileMapper.selectByUserId(userId);
        if (userProfile == null) {
            log.warn("ç”¨æˆ·ç”»åƒä¸å­˜åœ¨ï¼ŒuserId: {}", userId);
            return popularRecommend(limit);
        }
        
        List<UserBehavior> userBehaviors = userBehaviorMapper.selectByUserId(userId, 200); // å¢åŠ æ•°æ®é‡
        if (CollUtil.isEmpty(userBehaviors)) {
            log.info("ç”¨æˆ·æ— å†å²è¡Œä¸ºè®°å½•ï¼Œè¿”å›çƒ­é—¨æ¨èï¼ŒuserId: {}", userId);
            return popularRecommend(limit);
        }
        
        // 2. æ‰¹é‡è·å–å€™é€‰ç”¨æˆ·ï¼ˆè§£å†³N+1æŸ¥è¯¢é—®é¢˜ï¼‰
        List<UserProfile> candidateProfiles = userProfileMapper.selectSimilarProfiles(
                userProfile.getUserType(), userProfile.getRegion(), 30);
        
        List<Long> candidateUserIds = candidateProfiles.stream()
                .map(UserProfile::getUserId)
                .filter(id -> !id.equals(userId))
                .collect(Collectors.toList());
        
        Map<Long, List<UserBehavior>> candidateBehaviorsMap = batchGetUserBehaviors(candidateUserIds);
        
        // 3. ä¼˜åŒ–çš„ç”¨æˆ·ç›¸ä¼¼åº¦è®¡ç®—
        Map<Long, Double> userSimilarities = calculateUserSimilaritiesOptimized(
                userId, userBehaviors, candidateBehaviorsMap, candidateProfiles);
        
        // 4. ç­›é€‰é«˜ç›¸ä¼¼åº¦ç”¨æˆ·ï¼ˆä½¿ç”¨é…ç½®é˜ˆå€¼ï¼‰
        List<Long> similarUserIds = userSimilarities.entrySet().stream()
                .filter(entry -> entry.getValue() > recommendationConfig.getSimilarityThreshold())
                .sorted(Map.Entry.<Long, Double>comparingByValue().reversed())
                .limit(15) // å¢åŠ å€™é€‰ç”¨æˆ·æ•°é‡
                .map(Map.Entry::getKey)
                .collect(Collectors.toList());
        
        // 5. è®¡ç®—å•†å“æ¨èè¯„åˆ†ï¼ˆæ™ºèƒ½é™æƒï¼‰
        Map<Long, Double> itemScores = calculateItemScores(
                userBehaviors, candidateBehaviorsMap, similarUserIds, userSimilarities);
        
        // 6. è¿‡æ»¤å·²è´­ä¹°å•†å“å¹¶è¿”å›ç»“æœ
        Set<Long> userPurchasedItems = getUserPurchasedItems(userBehaviors);
        return itemScores.entrySet().stream()
                .filter(entry -> !userPurchasedItems.contains(entry.getKey()))
                .sorted(Map.Entry.<Long, Double>comparingByValue().reversed())
                .limit(limit)
                .map(this::createRecommendationVO)
                .collect(Collectors.toList());
                
    } catch (Exception e) {
        log.error("ååŒè¿‡æ»¤æ¨èå¤±è´¥ï¼ŒuserId: {}", userId, e);
        return Collections.emptyList();
    }
}
```

#### 4.1.2 æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–ï¼ˆè§£å†³N+1é—®é¢˜ï¼‰
```java
private Map<Long, List<UserBehavior>> batchGetUserBehaviors(List<Long> userIds) {
    if (CollUtil.isEmpty(userIds)) return new HashMap<>();
    
    Map<Long, List<UserBehavior>> result = new HashMap<>();
    int batchSize = 100;
    
    for (int i = 0; i < userIds.size(); i += batchSize) {
        List<Long> batchIds = userIds.subList(i, Math.min(i + batchSize, userIds.size()));
        
        // æ‰¹é‡æŸ¥è¯¢è€Œéé€ä¸ªæŸ¥è¯¢
        List<UserBehavior> behaviors = userBehaviorMapper.selectByUserIds(batchIds, 50);
        
        // æŒ‰ç”¨æˆ·IDåˆ†ç»„
        Map<Long, List<UserBehavior>> batchResult = behaviors.stream()
                .collect(Collectors.groupingBy(UserBehavior::getUserId));
        result.putAll(batchResult);
    }
    return result;
}
```

#### 4.2.2 é…ç½®åŒ–çš„æ—¶é—´è¡°å‡æœºåˆ¶
```java
private double calculateTimeDecay(LocalDateTime behaviorTime) {
    if (behaviorTime == null) return 0.2;
    
    long daysDiff = Duration.between(behaviorTime, LocalDateTime.now()).toDays();
    
    if (daysDiff <= 30) return 1.0;      // 30å¤©å†…æƒé‡ä¸º1
    else if (daysDiff <= 60) return 0.8;  // 30-60å¤©æƒé‡0.8
    else if (daysDiff <= 90) return 0.6;  // 60-90å¤©æƒé‡0.6
    else if (daysDiff <= 180) return 0.4; // 90-180å¤©æƒé‡0.4
    else return 0.2;                      // 180å¤©ä»¥ä¸Šæƒé‡0.2
}
```

### 4.2 è¡Œä¸ºè¯„åˆ†æœºåˆ¶

#### 4.2.1 é…ç½®åŒ–çš„éšå¼è¯„åˆ†è®¡ç®—
```java
private Map<Long, Double> getUserItemRatings(List<UserBehavior> behaviors) {
    Map<Long, Double> ratings = new HashMap<>();
    
    for (UserBehavior behavior : behaviors) {
        Long itemId = behavior.getTargetId();
        
        // ä½¿ç”¨é…ç½®çš„è¡Œä¸ºæƒé‡ï¼ˆå…³é”®æ”¹è¿›ï¼‰
        double baseScore = recommendationConfig.getBehaviorWeight().getWeightByType(behavior.getBehaviorType());
        
        // å¯¹äºè¯„ä»·è¡Œä¸ºï¼Œä½¿ç”¨å®é™…è¯„åˆ†
        if (behavior.getBehaviorType() == 6 && behavior.getRating() != null) {
            baseScore = behavior.getRating().doubleValue();
        }
        
        // è€ƒè™‘è¡Œä¸ºæƒé‡å’Œæ—¶é—´è¡°å‡
        Double behaviorWeight = behavior.getBehaviorWeight() != null ? behavior.getBehaviorWeight() : 1.0;
        double timeDecay = calculateTimeDecay(behavior.getBehaviorTime());
        
        double finalRating = baseScore * behaviorWeight * timeDecay;
        ratings.merge(itemId, finalRating, Double::sum);
    }
    return ratings;
}
```

#### 4.2.2 æ™ºèƒ½é™æƒæœºåˆ¶
```java
private Map<Long, Double> calculateItemScores(
        List<UserBehavior> userBehaviors, Map<Long, List<UserBehavior>> candidateBehaviorsMap,
        List<Long> similarUserIds, Map<Long, Double> userSimilarities) {
    
    Map<Long, Double> itemScores = new HashMap<>();
    
    for (Long similarUserId : similarUserIds) {
        List<UserBehavior> similarUserBehaviors = candidateBehaviorsMap.get(similarUserId);
    else if (daysDiff <= 90) return 0.6;  // 60-90å¤©æƒé‡0.6
    else if (daysDiff <= 180) return 0.4; // 90-180å¤©æƒé‡0.4
    else return 0.2;                      // 180å¤©ä»¥ä¸Šæƒé‡0.2
}
```

### 4.3 æ··åˆæ¨èç®—æ³•ï¼ˆv2.0 æ ¸å¿ƒé‡æ„ï¼‰

#### 4.3.1 çœŸæ­£çš„åŠ æƒèåˆç®—æ³•
```java
@Override
public List<RecommendationVO> hybridRecommend(Long userId, Integer limit) {
    try {
        log.info("å¼€å§‹æ··åˆæ¨èï¼ŒuserId: {}, limit: {}", userId, limit);
        
        // å‚æ•°æ ¡éªŒ
        if (userId == null || limit == null || limit <= 0) {
            log.warn("æ··åˆæ¨èå‚æ•°æ— æ•ˆï¼ŒuserId: {}, limit: {}", userId, limit);
            return Collections.emptyList();
        }

        // 1. å¹¶è¡Œè·å–å„ç±»æ¨èç»“æœï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
        CompletableFuture<List<RecommendationVO>> cfFuture = CompletableFuture.supplyAsync(() -> 
            collaborativeFilteringRecommend(userId, Math.max(10, limit / 2)));
        
        CompletableFuture<List<RecommendationVO>> cbFuture = CompletableFuture.supplyAsync(() -> 
            contentBasedRecommend(userId, Math.max(10, limit / 2)));
        
        CompletableFuture<List<RecommendationVO>> personalizedFuture = CompletableFuture.supplyAsync(() -> 
            personalizedRecommend(userId, Math.max(10, limit / 2)));
        
        CompletableFuture<List<RecommendationVO>> popularFuture = CompletableFuture.supplyAsync(() -> 
            popularRecommend(Math.max(10, limit / 2)));

        // 2. å®‰å…¨è·å–æ¨èç»“æœï¼ˆå¸¦å¼‚å¸¸å¤„ç†ï¼‰
        List<RecommendationVO> cfRecommendations = safeGetRecommendations(cfFuture, "ååŒè¿‡æ»¤");
        List<RecommendationVO> cbRecommendations = safeGetRecommendations(cbFuture, "å†…å®¹æ¨è");
        List<RecommendationVO> personalizedRecommendations = safeGetRecommendations(personalizedFuture, "ä¸ªæ€§åŒ–æ¨è");
        List<RecommendationVO> popularRecommendations = safeGetRecommendations(popularFuture, "çƒ­é—¨æ¨è");
        
        // 3. çœŸæ­£çš„æ··åˆæ¨èç®—æ³•ï¼ˆåŠ æƒèåˆï¼‰
        Map<Long, HybridRecommendationItem> hybridScores = new HashMap<>();
        
        // æŒ‰ç…§æƒé‡ç§¯ç´¯å„ç®—æ³•çš„è¯„åˆ†
        processAlgorithmResults(hybridScores, cfRecommendations, 
            recommendationConfig.getHybridWeight().getCollaborative(), "ååŒè¿‡æ»¤");
        processAlgorithmResults(hybridScores, cbRecommendations, 
            recommendationConfig.getHybridWeight().getContent(), "å†…å®¹æ¨è");
        processAlgorithmResults(hybridScores, personalizedRecommendations, 
            recommendationConfig.getHybridWeight().getPersonalized(), "ä¸ªæ€§åŒ–æ¨è");
        processAlgorithmResults(hybridScores, popularRecommendations, 
            recommendationConfig.getHybridWeight().getPopular(), "çƒ­é—¨æ¨è");
        
        // 4. æŒ‰ç…§æœ€ç»ˆè¯„åˆ†æ’åºå¹¶è¿”å›ç»“æœ
        if (hybridScores.isEmpty()) {
            log.warn("æ‰€æœ‰æ¨èç®—æ³•éƒ½æ²¡æœ‰ç»“æœï¼Œä½¿ç”¨å¤‡é€‰çƒ­é—¨æ¨èï¼ŒuserId: {}", userId);
            return popularRecommend(limit);
        }
        
        List<RecommendationVO> finalResults = hybridScores.values().stream()
                .filter(item -> item.getFinalScore() > 0)
                .sorted((a, b) -> Double.compare(b.getFinalScore(), a.getFinalScore()))
                .limit(limit)
                .map(item -> {
                    RecommendationVO vo = item.getRecommendationVO();
                    vo.setRecommendationScore(BigDecimal.valueOf(item.getFinalScore()));
                    vo.setRecommendationType(99); // æ··åˆæ¨èç±»å‹
                    vo.setRecommendationTypeName("æ··åˆæ¨è");
                    vo.setRecommendationReason("æ··åˆæ¨è:" + item.getReason());
                    return vo;
                })
                .collect(Collectors.toList());
                
        // 5. å¦‚æœç»“æœä¸è¶³ï¼Œè¡¥å……çƒ­é—¨æ¨è
        if (finalResults.size() < limit) {
            int remaining = limit - finalResults.size();
            List<RecommendationVO> supplementary = popularRecommend(remaining * 2);
            Set<Long> existingIds = finalResults.stream()
                .map(RecommendationVO::getTargetId).collect(Collectors.toSet());
            
            supplementary.stream()
                .filter(vo -> !existingIds.contains(vo.getTargetId()))
                .limit(remaining)
                .forEach(finalResults::add);
        }
        
        return finalResults;
        
    } catch (Exception e) {
        log.error("æ··åˆæ¨èå¤±è´¥ï¼Œé™çº§ä¸ºçƒ­é—¨æ¨èï¼ŒuserId: {}, limit: {}", userId, limit, e);
        // å¼‚å¸¸æƒ…å†µä¸‹è¿”å›çƒ­é—¨æ¨èä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ
        try {
            return popularRecommend(limit);
        } catch (Exception fallbackException) {
            log.error("å¤‡é€‰çƒ­é—¨æ¨èä¹Ÿå¤±è´¥ï¼ŒuserId: {}", userId, fallbackException);
            return Collections.emptyList();
        }
    }
}
```

#### 4.3.2 æ··åˆæ¨èé¡¹ç›®ç±»
```java
public static class HybridRecommendationItem {
    private RecommendationVO recommendationVO;
    private double finalScore;
    private List<String> algorithms;
    private String reason;
    
    public HybridRecommendationItem(RecommendationVO vo) {
        this.recommendationVO = vo;
        this.finalScore = 0.0;
        this.algorithms = new ArrayList<>();
        this.reason = "";
    }
    
    public void addAlgorithmScore(String algorithm, double weight, double score) {
        finalScore += weight * score; // çœŸæ­£çš„åŠ æƒèåˆ
        algorithms.add(algorithm);
        if (reason.isEmpty()) {
            reason = algorithm;
        } else {
            reason += "+" + algorithm;
        }
    }
    
    // getters...
}
```

#### 4.3.3 ç®—æ³•ç»“æœå¤„ç†
```java
private void processAlgorithmResults(Map<Long, HybridRecommendationItem> hybridScores, 
                                    List<RecommendationVO> results, 
                                    Double weight, 
                                    String algorithmName) {
    for (RecommendationVO vo : results) {
        Long targetId = vo.getTargetId();
        double score = vo.getRecommendationScore() != null ? 
            vo.getRecommendationScore().doubleValue() : 0.0;
        
        HybridRecommendationItem item = hybridScores.computeIfAbsent(targetId, 
            k -> new HybridRecommendationItem(vo));
        
        item.addAlgorithmScore(algorithmName, weight, score);
    }
}
```

#### 4.3.4 å®‰å…¨è·å–æ¨èç»“æœ
```java
private List<RecommendationVO> safeGetRecommendations(
        CompletableFuture<List<RecommendationVO>> future, String algorithmName) {
    try {
        List<RecommendationVO> result = future.join();
        return result != null ? result : Collections.emptyList();
    } catch (Exception e) {
        log.warn("{}ç®—æ³•æ‰§è¡Œå¼‚å¸¸ï¼Œè·³è¿‡è¯¥ç®—æ³•", algorithmName, e);
        return Collections.emptyList();
    }
}
```

## 5. é…ç½®åŒ–ç®¡ç†

### 5.1 æ¨èå‚æ•°é…ç½®
```yaml
recommendation:
  # ç›¸ä¼¼åº¦é˜ˆå€¼
  similarity-threshold: 0.1
  # æ—¶é—´è¡°å‡å¤©æ•°
  time-decay-days: 30
  # æœ€è¿‘è´­ä¹°å¤©æ•°
  recent-purchase-days: 30
  # è¡Œä¸ºæƒé‡é…ç½®
  behavior-weight:
    view: 1.0
    search: 1.5
    collect: 3.0
    cart: 3.5
    purchase: 5.0
    rate: 4.0
  # æ··åˆæ¨èæƒé‡é…ç½®
  hybrid-weight:
    collaborative: 0.30
    content: 0.25
    personalized: 0.25
    popular: 0.20
  # ç”¨æˆ·ç›¸ä¼¼åº¦æƒé‡é…ç½®
  similarity-weight:
    behavior: 0.7
    profile: 0.3
  # é™æƒé…ç½®
  downgrade:
    enabled: true
    recent-purchase-ratio: 0.3
```

### 5.2 é…ç½®ç±»å®ç°
```java
@Data
@Configuration
@ConfigurationProperties(prefix = "recommendation")
public class RecommendationConfig {
    private Double similarityThreshold = 0.1;
    private Integer timeDecayDays = 30;
    private Integer recentPurchaseDays = 30;
    private BehaviorWeight behaviorWeight = new BehaviorWeight();
    private HybridWeight hybridWeight = new HybridWeight();
    private SimilarityWeight similarityWeight = new SimilarityWeight();
    private DowngradeConfig downgrade = new DowngradeConfig();
    
    @Data
    public static class BehaviorWeight {
        private Double view = 1.0;
        private Double search = 1.5;
        private Double collect = 3.0;
        private Double cart = 3.5;
        private Double purchase = 5.0;
        private Double rate = 4.0;
        
        public Double getWeightByType(Integer behaviorType) {
            switch (behaviorType) {
                case 1: return view;
                case 2: return search;
                case 3: return collect;
                case 4: return cart;
                case 5: return purchase;
                case 6: return rate;
                default: return 1.0;
            }
        }
    }
}
```

## 6. ç”¨æˆ·ç”»åƒç³»ç»Ÿ

### 4.1 ç”»åƒæ›´æ–°æœºåˆ¶
```java
@Transactional(rollbackFor = Exception.class)
public void updateUserProfile(Long userId) {
    // 1. è·å–ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡
    List<UserBehavior> behaviors = userBehaviorMapper.selectByUserId(userId, 1000);
    if (CollUtil.isEmpty(behaviors)) return;
    
    // 2. è®¡ç®—ç”¨æˆ·ç”»åƒæŒ‡æ ‡
    UserProfile profile = userProfileMapper.selectByUserId(userId);
    if (profile == null) {
        profile = new UserProfile();
        profile.setUserId(userId);
    }
    
    // 3. è®¡ç®—å„é¡¹æŒ‡æ ‡
    calculateActivityLevel(profile, behaviors);      // æ´»è·ƒåº¦
    calculatePurchaseFrequency(profile, userId);     // è´­ä¹°é¢‘ç‡
    calculatePriceSensitivity(profile, behaviors);   // ä»·æ ¼æ•æ„Ÿåº¦
    calculateQualityRequirement(profile, behaviors); // è´¨é‡è¦æ±‚
    
    // 4. ä¿å­˜ç”¨æˆ·ç”»åƒ
    saveOrUpdateProfile(profile);
}
```

### 4.2 ç”»åƒæŒ‡æ ‡è®¡ç®—
```java
// æ´»è·ƒåº¦è®¡ç®— (åŸºäºæœ€è¿‘30å¤©è¡Œä¸º)
private void calculateActivityLevel(UserProfile profile, List<UserBehavior> behaviors) {
    long recentBehaviors = behaviors.stream()
        .filter(b -> b.getBehaviorTime().isAfter(LocalDateTime.now().minusDays(30)))
        .count();
    profile.setActivityLevel(BigDecimal.valueOf(Math.min(recentBehaviors / 30.0, 1.0)));
}

// ä»·æ ¼æ•æ„Ÿåº¦è®¡ç®— (åŸºäºè´­ä¹°å•†å“ä»·æ ¼)
private void calculatePriceSensitivity(UserProfile profile, List<UserBehavior> behaviors) {
    List<UserBehavior> purchaseBehaviors = behaviors.stream()
        .filter(b -> b.getBehaviorType() == 5)
        .collect(Collectors.toList());
    
    if (!purchaseBehaviors.isEmpty()) {
        double avgPurchasePrice = calculateAveragePurchasePrice(purchaseBehaviors);
        // ä»·æ ¼æ•æ„Ÿåº¦ = (æœ€é«˜ä»·æ ¼ - å¹³å‡è´­ä¹°ä»·æ ¼) / æœ€é«˜ä»·æ ¼
        double sensitivity = Math.max(0.0, Math.min(1.0, (200.0 - avgPurchasePrice) / 200.0));
        profile.setPriceSensitivity(BigDecimal.valueOf(sensitivity));
    } else {
        profile.setPriceSensitivity(BigDecimal.valueOf(0.5)); // é»˜è®¤ä¸­ç­‰æ•æ„Ÿåº¦
    }
}
```

## 5. APIæ¥å£è®¾è®¡

### 5.1 æ¨èæ¥å£
```java
@RestController
@RequestMapping("/wx/recommend")
public class WxRecommendController {
    
    @GetMapping("/list")
    public Result<List<RecommendationVO>> recommend(@RequestParam(defaultValue = "10") Integer limit) {
        Long userId = SecurityUtils.getCurrentUserId();
        List<RecommendationVO> list;
        
        if (userId == null) {
            // æœªç™»å½•ç”¨æˆ·è¿”å›çƒ­é—¨æ¨è
            list = recommendationService.popularRecommend(limit);
        } else {
            // å·²ç™»å½•ç”¨æˆ·è¿”å›æ··åˆæ¨è
            list = recommendationService.hybridRecommend(userId, limit);
        }
        return Result.success(list);
    }
    
    @PostMapping("/behavior")
    public Result<Void> reportBehavior(@Valid @RequestBody UserBehaviorReportDTO dto) {
        Long userId = SecurityUtils.getCurrentUserId();
        if (userId == null) {
            return Result.fail(ResultCode.USER_NOT_LOGIN);
        }
        
        recommendationService.recordUserBehavior(userId, dto.getBehaviorType(), 
            1, dto.getSeedId(), dto.getSource(), dto.getDuration().doubleValue());
        return Result.success();
    }
}
```

### 5.2 ç®¡ç†æ¥å£
```java
@RestController  
@RequestMapping("/recommendation")
public class RecommendationController {
    
    // ååŒè¿‡æ»¤æ¨è
    @GetMapping("/collaborative/{userId}")
    public Result<List<RecommendationVO>> collaborativeFilteringRecommend(
        @PathVariable Long userId, @RequestParam(defaultValue = "10") Integer limit) {
        List<RecommendationVO> recommendations = 
            recommendationService.collaborativeFilteringRecommend(userId, limit);
        return Result.success(recommendations);
    }
    
    // æ‰‹åŠ¨æ›´æ–°ç”¨æˆ·ç”»åƒ
    @PostMapping("/profile/update/{userId}")
    public Result<Void> updateUserProfile(@PathVariable Long userId) {
        recommendationService.updateUserProfile(userId);
        return Result.success();
    }
    
    // åˆ†é¡µæŸ¥è¯¢æ¨èç»“æœ
    @GetMapping("/page")
    public Result<PageResult<Recommendation>> getRecommendationPage(
        PageQuery pageQuery, @RequestParam(required = false) Long userId) {
        // å®ç°åˆ†é¡µæŸ¥è¯¢é€»è¾‘
        return Result.success(pageResult);
    }
}
```

## 10. æ¨èæ¨¡å—å®ç°è¯¦è¿°

### 10.1 ç³»ç»Ÿæ¶æ„ä¸è®¾è®¡ç†å¿µ

æœ¬æ¨èç³»ç»Ÿé‡‡ç”¨äº†åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œä»åº•å±‚æ•°æ®æ”¶é›†åˆ°é¡¶å±‚ç®—æ³•èåˆï¼Œæ„å»ºäº†ä¸€ä¸ªå®Œæ•´çš„æ™ºèƒ½æ¨èç”Ÿæ€ã€‚ç³»ç»Ÿçš„æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯é€šè¿‡å¤šç»´åº¦æ•°æ®æŒ–æ˜å’Œå¤šç®—æ³•ååŒå·¥ä½œï¼Œä¸ºç”¨æˆ·æä¾›ç²¾å‡†ã€å¤šæ ·åŒ–çš„ä¸ªæ€§åŒ–æ¨èæœåŠ¡ã€‚åœ¨æ¶æ„å±‚é¢ï¼Œç³»ç»Ÿåˆ†ä¸ºæ•°æ®å±‚ã€ç®—æ³•å±‚ã€æœåŠ¡å±‚å’Œåº”ç”¨å±‚å››ä¸ªä¸»è¦å±‚æ¬¡ã€‚æ•°æ®å±‚è´Ÿè´£æ”¶é›†å’Œå­˜å‚¨ç”¨æˆ·è¡Œä¸ºæ•°æ®ã€ç”¨æˆ·ç”»åƒä¿¡æ¯ä»¥åŠå•†å“ç‰¹å¾æ•°æ®ï¼Œä¸ºä¸Šå±‚ç®—æ³•æä¾›ä¸°å¯Œçš„æ•°æ®åŸºç¡€ï¼›ç®—æ³•å±‚å®ç°äº†ååŒè¿‡æ»¤ã€å†…å®¹æ¨èã€ä¸ªæ€§åŒ–æ¨èå’Œçƒ­é—¨æ¨èå››ç§æ ¸å¿ƒç®—æ³•ï¼Œæ¯ç§ç®—æ³•éƒ½æœ‰å…¶ç‹¬ç‰¹çš„åº”ç”¨åœºæ™¯å’Œä¼˜åŠ¿ï¼›æœåŠ¡å±‚é€šè¿‡Spring Bootæ¡†æ¶æä¾›RESTful APIæ¥å£ï¼Œå®ç°äº†æ¨èæœåŠ¡çš„ç»Ÿä¸€ç®¡ç†å’Œè°ƒç”¨ï¼›åº”ç”¨å±‚åˆ™åŒ…æ‹¬Webç®¡ç†ç«¯å’Œå°ç¨‹åºç”¨æˆ·ç«¯ï¼Œä¸ºä¸åŒè§’è‰²çš„ç”¨æˆ·æä¾›ç›¸åº”çš„åŠŸèƒ½ç•Œé¢ã€‚

æ•´ä¸ªç³»ç»Ÿçš„è®¾è®¡å……åˆ†è€ƒè™‘äº†ç”µå•†åœºæ™¯çš„ç‰¹æ®Šæ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†ç”¨æˆ·é‡å¤è´­ä¹°è¡Œä¸ºã€å•†å“å­£èŠ‚æ€§ç‰¹å¾ä»¥åŠæ–°ç”¨æˆ·å†·å¯åŠ¨ç­‰é—®é¢˜ä¸Šï¼Œé‡‡ç”¨äº†åˆ›æ–°çš„è§£å†³æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œåœ¨ååŒè¿‡æ»¤ç®—æ³•ä¸­ï¼Œç³»ç»Ÿå¹¶ä¸ç®€å•åœ°è¿‡æ»¤ç”¨æˆ·å·²è´­ä¹°çš„å•†å“ï¼Œè€Œæ˜¯é‡‡ç”¨æ™ºèƒ½é™æƒçš„ç­–ç•¥ï¼Œå°†æœ€è¿‘30å¤©å†…è´­ä¹°çš„å•†å“æƒé‡é™ä½åˆ°30%ï¼Œè¿™æ ·æ—¢é¿å…äº†è¿‡åº¦æ¨èç”¨æˆ·å·²æ‹¥æœ‰çš„å•†å“ï¼Œåˆä¿æŒäº†æ¨èçš„å¤šæ ·æ€§å’Œå®ç”¨æ€§ã€‚åŒæ—¶ï¼Œç³»ç»Ÿå¼•å…¥äº†æ—¶é—´è¡°å‡æœºåˆ¶ï¼Œä½¿å¾—ç”¨æˆ·çš„å†å²è¡Œä¸ºéšæ—¶é—´æ¨ç§»é€æ¸é™ä½å½±å“æƒé‡ï¼Œç¡®ä¿æ¨èç»“æœèƒ½å¤Ÿåæ˜ ç”¨æˆ·å½“å‰çš„å…´è¶£åå¥½ã€‚

### 10.2 æ ¸å¿ƒç®—æ³•å®ç°ä¸ä¼˜åŒ–

ç³»ç»Ÿçš„æ ¸å¿ƒç«äº‰åŠ›åœ¨äºå…¶ç²¾å¿ƒè®¾è®¡çš„å¤šç®—æ³•èåˆæœºåˆ¶å’Œå…ˆè¿›çš„ç›¸ä¼¼åº¦è®¡ç®—æ–¹æ³•ã€‚åœ¨ååŒè¿‡æ»¤ç®—æ³•çš„å®ç°ä¸­ï¼Œç³»ç»Ÿé‡‡ç”¨äº†åŸºäºç”¨æˆ·çš„ååŒè¿‡æ»¤æ–¹æ³•ï¼Œé€šè¿‡è®¡ç®—ç”¨æˆ·ä¹‹é—´çš„ç›¸ä¼¼åº¦æ¥é¢„æµ‹ç›®æ ‡ç”¨æˆ·å¯¹æœªæ¥è§¦å•†å“çš„åå¥½ç¨‹åº¦ã€‚ç›¸ä¼¼åº¦è®¡ç®—é‡‡ç”¨äº†åˆ›æ–°çš„åŒé‡åŠ æƒç­–ç•¥ï¼šé¦–å…ˆé€šè¿‡ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—ç”¨æˆ·è¡Œä¸ºå‘é‡çš„ç›¸ä¼¼æ€§ï¼Œç„¶åç»“åˆç”¨æˆ·ç”»åƒç‰¹å¾è®¡ç®—ç”»åƒç›¸ä¼¼åº¦ï¼Œæœ€ç»ˆå°†è¡Œä¸ºç›¸ä¼¼åº¦ï¼ˆæƒé‡70%ï¼‰å’Œç”»åƒç›¸ä¼¼åº¦ï¼ˆæƒé‡30%ï¼‰è¿›è¡ŒåŠ æƒèåˆï¼Œå¾—åˆ°æ›´åŠ å‡†ç¡®å’Œå…¨é¢çš„ç”¨æˆ·ç›¸ä¼¼åº¦è¯„åˆ†ã€‚è¿™ç§æ–¹æ³•ä¸ä»…è€ƒè™‘äº†ç”¨æˆ·çš„æ˜¾æ€§è¡Œä¸ºæ¨¡å¼ï¼Œè¿˜èå…¥äº†ç”¨æˆ·çš„éšæ€§ç‰¹å¾å±æ€§ï¼Œæ˜¾è‘—æå‡äº†æ¨èçš„å‡†ç¡®æ€§ã€‚

åœ¨éšå¼è¯„åˆ†æœºåˆ¶çš„è®¾è®¡ä¸Šï¼Œç³»ç»Ÿæ ¹æ®ä¸åŒè¡Œä¸ºç±»å‹çš„é‡è¦æ€§å’Œå¯ä¿¡åº¦ï¼Œä¸ºæ¯ç§ç”¨æˆ·è¡Œä¸ºåˆ†é…äº†å·®å¼‚åŒ–çš„åŸºç¡€è¯„åˆ†ï¼šæµè§ˆè¡Œä¸º1.0åˆ†ã€æœç´¢è¡Œä¸º1.5åˆ†ã€æ”¶è—è¡Œä¸º3.0åˆ†ã€åŠ è´­ç‰©è½¦è¡Œä¸º3.5åˆ†ã€è´­ä¹°è¡Œä¸º5.0åˆ†ã€è¯„ä»·è¡Œä¸º4.0åˆ†ã€‚è¿™ç§è¯„åˆ†ä½“ç³»å……åˆ†ä½“ç°äº†ç”¨æˆ·è¡Œä¸ºçš„ä»·å€¼å±‚æ¬¡ï¼Œè´­ä¹°è¡Œä¸ºä½œä¸ºæœ€å¼ºçš„åå¥½ä¿¡å·è·å¾—æœ€é«˜è¯„åˆ†ï¼Œè€Œè¯„ä»·è¡Œä¸ºè™½ç„¶è¡¨è¾¾äº†æ˜ç¡®çš„æ€åº¦ä½†å¯èƒ½å­˜åœ¨ä¸»è§‚æ€§å› æ­¤è¯„åˆ†ç•¥ä½äºè´­ä¹°ã€‚ç³»ç»Ÿè¿˜å¼•å…¥äº†è¡Œä¸ºæƒé‡å’Œæ—¶é—´è¡°å‡å› å­çš„æ¦‚å¿µï¼Œä½¿å¾—è¯„åˆ†è®¡ç®—æ›´åŠ ç²¾ç»†åŒ–ï¼šè¡Œä¸ºæƒé‡åæ˜ äº†ç‰¹å®šè¡Œä¸ºåœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­çš„é‡è¦æ€§ï¼Œè€Œæ—¶é—´è¡°å‡å› å­åˆ™ç¡®ä¿äº†è¿‘æœŸè¡Œä¸ºæ¯”å†å²è¡Œä¸ºå…·æœ‰æ›´é«˜çš„å½±å“åŠ›ï¼Œ30å¤©å†…çš„è¡Œä¸ºä¿æŒåŸå§‹æƒé‡ï¼Œä¹‹åæŒ‰ç…§æŒ‡æ•°è¡°å‡è§„å¾‹é€æ­¥é™ä½æƒé‡ã€‚

### 10.3 ç”¨æˆ·ç”»åƒå»ºæ¨¡ä¸åŠ¨æ€æ›´æ–°

ç”¨æˆ·ç”»åƒç³»ç»Ÿæ˜¯æ¨èå¼•æ“çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒé€šè¿‡å¯¹ç”¨æˆ·å†å²è¡Œä¸ºæ•°æ®çš„æ·±åº¦æŒ–æ˜å’Œç»Ÿè®¡åˆ†æï¼Œæ„å»ºäº†å¤šç»´åº¦çš„ç”¨æˆ·ç‰¹å¾æ¨¡å‹ã€‚ç³»ç»Ÿè®¾è®¡äº†äº”ä¸ªæ ¸å¿ƒç”»åƒæŒ‡æ ‡ï¼šæ´»è·ƒåº¦åæ˜ ç”¨æˆ·åœ¨å¹³å°ä¸Šçš„å‚ä¸ç¨‹åº¦ï¼Œé€šè¿‡ç»Ÿè®¡ç”¨æˆ·æœ€è¿‘30å¤©çš„è¡Œä¸ºæ¬¡æ•°å¹¶æ ‡å‡†åŒ–åˆ°0-1åŒºé—´ï¼›è´­ä¹°é¢‘ç‡ä½“ç°ç”¨æˆ·çš„æ¶ˆè´¹æ´»è·ƒåº¦ï¼Œé€šè¿‡å†å²è´­ä¹°æ¬¡æ•°ä¸åŸºå‡†å€¼çš„æ¯”è¾ƒæ¥é‡åŒ–ï¼›ä»·æ ¼æ•æ„Ÿåº¦é€šè¿‡åˆ†æç”¨æˆ·è´­ä¹°å•†å“çš„ä»·æ ¼åˆ†å¸ƒç‰¹å¾æ¥åˆ¤æ–­ç”¨æˆ·å¯¹ä»·æ ¼çš„æ•æ„Ÿç¨‹åº¦ï¼Œè®¡ç®—å…¬å¼ä¸º(æœ€é«˜ä»·æ ¼-å¹³å‡è´­ä¹°ä»·æ ¼)/æœ€é«˜ä»·æ ¼ï¼›è´¨é‡è¦æ±‚é€šè¿‡ç”¨æˆ·çš„è¯„ä»·è¡Œä¸ºå’Œè¯„åˆ†æ•°æ®æ¥è¡¡é‡ç”¨æˆ·å¯¹å•†å“è´¨é‡çš„æœŸæœ›æ°´å¹³ï¼›å“ç‰Œå¿ è¯šåº¦åˆ™é€šè¿‡åˆ†æç”¨æˆ·å¯¹ç‰¹å®šå“ç‰Œçš„é‡å¤è´­ä¹°è¡Œä¸ºæ¥è¯„ä¼°ã€‚è¿™äº›æŒ‡æ ‡çš„è®¡ç®—éƒ½åŸºäºä¸¥æ ¼çš„æ•°å­¦æ¨¡å‹ï¼Œç¡®ä¿äº†ç”»åƒæ•°æ®çš„å‡†ç¡®æ€§å’Œå¯è§£é‡Šæ€§ã€‚

ç”¨æˆ·ç”»åƒçš„æ›´æ–°é‡‡ç”¨äº†å¼‚æ­¥æœºåˆ¶ï¼Œæ¯å½“ç”¨æˆ·äº§ç”Ÿæ–°çš„è¡Œä¸ºæ•°æ®æ—¶ï¼Œç³»ç»Ÿä¼šè§¦å‘å¼‚æ­¥ä»»åŠ¡æ¥é‡æ–°è®¡ç®—å’Œæ›´æ–°ç”¨æˆ·ç”»åƒã€‚è¿™ç§è®¾è®¡æ—¢ä¿è¯äº†ç”»åƒæ•°æ®çš„å®æ—¶æ€§ï¼Œåˆé¿å…äº†åŒæ­¥æ›´æ–°å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“ã€‚æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šç»¼åˆè€ƒè™‘ç”¨æˆ·çš„å…¨éƒ¨å†å²è¡Œä¸ºï¼Œè€Œä¸æ˜¯ç®€å•çš„å¢é‡æ›´æ–°ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ç”»åƒçš„ç¨³å®šæ€§å’Œä¸€è‡´æ€§ã€‚åŒæ—¶ï¼Œç³»ç»Ÿè¿˜å®ç°äº†ç”»åƒæ•°æ®çš„ç‰ˆæœ¬ç®¡ç†å’Œå›æ»šæœºåˆ¶ï¼Œåœ¨å‡ºç°å¼‚å¸¸æƒ…å†µæ—¶å¯ä»¥å¿«é€Ÿæ¢å¤åˆ°ä¹‹å‰çš„ç¨³å®šçŠ¶æ€ã€‚

### 10.4 æ··åˆæ¨èç­–ç•¥ä¸æ€§èƒ½ä¼˜åŒ–

æ··åˆæ¨èæ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒåˆ›æ–°ç‚¹ï¼Œå®ƒå°†å››ç§ä¸åŒçš„æ¨èç®—æ³•æŒ‰ç…§ç§‘å­¦çš„æƒé‡æ¯”ä¾‹è¿›è¡Œèåˆï¼šååŒè¿‡æ»¤æ¨èå 30%æƒé‡ï¼Œä¸»è¦è§£å†³åŸºäºç”¨æˆ·ç›¸ä¼¼æ€§çš„æ¨èé—®é¢˜ï¼›å†…å®¹æ¨èå 25%æƒé‡ï¼Œé€šè¿‡å•†å“ç‰¹å¾åŒ¹é…æ¥å‘ç°ç”¨æˆ·å¯èƒ½æ„Ÿå…´è¶£çš„å•†å“ï¼›ä¸ªæ€§åŒ–æ¨èå 25%æƒé‡ï¼ŒåŸºäºç”¨æˆ·ç”»åƒè¿›è¡Œç²¾å‡†åŒ¹é…ï¼›çƒ­é—¨æ¨èå 20%æƒé‡ï¼Œç¡®ä¿æ¨èç»“æœçš„å¤šæ ·æ€§å’Œæµè¡Œåº¦ã€‚è¿™ç§æƒé‡åˆ†é…ç»è¿‡äº†å¤§é‡çš„å®éªŒéªŒè¯å’Œè°ƒä¼˜ï¼Œæ—¢ä¿è¯äº†æ¨èçš„ä¸ªæ€§åŒ–ç¨‹åº¦ï¼Œåˆå…¼é¡¾äº†æ¨èçš„è¦†ç›–é¢å’Œæ–°é¢–æ€§ã€‚åœ¨ç®—æ³•èåˆè¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿé‡‡ç”¨äº†åŠ æƒè¯„åˆ†çš„æ–¹æ³•ï¼Œå°†æ¯ç§ç®—æ³•çš„æ¨èç»“æœæŒ‰ç…§å…¶æƒé‡è¿›è¡Œè¯„åˆ†è®¡ç®—ï¼Œç„¶åé€šè¿‡å½’ä¸€åŒ–å¤„ç†å¾—åˆ°æœ€ç»ˆçš„æ¨èè¯„åˆ†ï¼Œç¡®ä¿äº†ä¸åŒç®—æ³•ç»“æœçš„å…¬å¹³ç«äº‰ã€‚

åœ¨æ€§èƒ½ä¼˜åŒ–æ–¹é¢ï¼Œç³»ç»Ÿé‡‡ç”¨äº†å¤šå±‚æ¬¡çš„ä¼˜åŒ–ç­–ç•¥ã€‚é¦–å…ˆæ˜¯ç®—æ³•å±‚é¢çš„ä¼˜åŒ–ï¼Œé€šè¿‡ç›¸ä¼¼åº¦è®¡ç®—çš„å¹¶è¡ŒåŒ–ã€è¯„åˆ†çŸ©é˜µçš„ç¨€ç–åŒ–å¤„ç†ä»¥åŠæ¨èç»“æœçš„ç¼“å­˜æœºåˆ¶ï¼Œæ˜¾è‘—æå‡äº†ç®—æ³•çš„æ‰§è¡Œæ•ˆç‡ã€‚å…¶æ¬¡æ˜¯æ•°æ®å±‚é¢çš„ä¼˜åŒ–ï¼Œé€šè¿‡åˆç†çš„æ•°æ®åº“ç´¢å¼•è®¾è®¡ã€åˆ†åŒºè¡¨çš„ä½¿ç”¨ä»¥åŠè¯»å†™åˆ†ç¦»çš„æ¶æ„ï¼Œä¿è¯äº†å¤§æ•°æ®é‡ä¸‹çš„æŸ¥è¯¢æ€§èƒ½ã€‚æœ€åæ˜¯ç³»ç»Ÿæ¶æ„å±‚é¢çš„ä¼˜åŒ–ï¼Œé‡‡ç”¨äº†å¼‚æ­¥å¤„ç†ã€æ¶ˆæ¯é˜Ÿåˆ—ã€åˆ†å¸ƒå¼ç¼“å­˜ç­‰æŠ€æœ¯ï¼Œå®ç°äº†ç³»ç»Ÿçš„é«˜å¹¶å‘å’Œé«˜å¯ç”¨ã€‚ç³»ç»Ÿè¿˜å»ºç«‹äº†å®Œå–„çš„ç›‘æ§å’Œé¢„è­¦æœºåˆ¶ï¼Œå®æ—¶ç›‘æ§æ¨èæœåŠ¡çš„æ€§èƒ½æŒ‡æ ‡ï¼ŒåŒ…æ‹¬å“åº”æ—¶é—´ã€ååé‡ã€å‡†ç¡®ç‡ç­‰å…³é”®æŒ‡æ ‡ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿç¨³å®šè¿è¡Œå¹¶åŠæ—¶å‘ç°å’Œè§£å†³æ½œåœ¨é—®é¢˜ã€‚é€šè¿‡è¿™äº›ç»¼åˆæ€§çš„ä¼˜åŒ–æªæ–½ï¼Œç³»ç»Ÿèƒ½å¤Ÿåœ¨ä¿è¯æ¨èè´¨é‡çš„å‰æä¸‹ï¼Œå®ç°æ¯«ç§’çº§çš„å“åº”é€Ÿåº¦å’Œé«˜å¹¶å‘çš„æœåŠ¡èƒ½åŠ›ã€‚

