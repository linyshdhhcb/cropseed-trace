# 应用基础配置
spring:
  application:
    name: cropseed-trace-system
  profiles:
    active: prod
  
  # 数据源配置（请修改为您自己的MySQL服务器信息）
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://192.168.1.100:3306/cropseed_trace?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=false&serverTimezone=GMT%2B8&allowPublicKeyRetrieval=true
    username: root
    password: your_mysql_password
    druid:
      # 初始连接数
      initial-size: 5
      # 最小连接池数量
      min-idle: 10
      # 最大连接池数量
      max-active: 20
      # 配置获取连接等待超时的时间
      max-wait: 60000
      # 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒
      time-between-eviction-runs-millis: 60000
      # 配置一个连接在池中最小生存的时间，单位是毫秒
      min-evictable-idle-time-millis: 300000
      # 配置一个连接在池中最大生存的时间，单位是毫秒
      max-evictable-idle-time-millis: 900000
      # 配置检测连接是否有效
      validation-query: SELECT 1
      test-while-idle: true
      test-on-borrow: false
      test-on-return: false
      # 打开PSCache，并且指定每个连接上PSCache的大小
      pool-prepared-statements: true
      max-pool-prepared-statement-per-connection-size: 20
      # 配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙
      filters: stat,wall
      # 通过connectProperties属性来打开mergeSql功能；慢SQL记录
      connection-properties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000
  
  # Redis配置（请修改为您自己的Redis服务器信息）
  data:
    redis:
      database: 7
      host: 192.168.1.100
      port: 6379
      password: your_redis_password
      timeout: 10000ms
      lettuce:
        pool:
          # 连接池最大连接数
          max-active: 200
          # 连接池最大阻塞等待时间
          max-wait: -1ms
          # 连接池中的最大空闲连接
          max-idle: 10
          # 连接池中的最小空闲连接
          min-idle: 5
  
  # Jackson配置
  jackson:
    serialization:
      write-enums-using-to-string: true
      write-dates-as-timestamps: false
    deserialization:
      read-enums-using-to-string: true
      fail-on-unknown-properties: false
    default-property-inclusion: non_null
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8
  
  # 文件上传配置
  servlet:
    multipart:
      max-file-size: 100MB
      max-request-size: 200MB
      enabled: true
  
  # 邮件配置（如需使用邮件功能，请填写）
  mail:
    host: smtp.qq.com
    port: 465
    username: your_email@qq.com
    password: your_email_password
    protocol: smtp
    properties:
      mail:
        smtp:
          auth: true
          ssl:
            enable: true
            trust: smtp.qq.com
    default-encoding: utf-8

# 服务器配置
server:
  port: 8085
  servlet:
    context-path:
    encoding:
      charset: UTF-8
      enabled: true
      force: true
  # 优雅关闭
  shutdown: graceful

# MyBatis-Plus配置
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      logic-delete-field: deleted_flag
      logic-delete-value: 1
      logic-not-delete-value: 0

# 对象存储统一配置
storage:
  type: minio              # 存储类型：minio, oss, cos, s3, local
  enabled: true            # 是否启用存储功能
  default-bucket: cropseed-trace

# MinIO对象存储配置（请修改为您自己的MinIO服务器信息）
minio:
  endpoint: http://192.168.1.100:9000
  accessKey: admin
  secretKey: your_minio_password
  bucketName: cropseed-trace

# 腾讯云TBaaS区块链配置（请填写您的区块链服务信息）
tencent:
  tbaas:
    # 认证信息
    secret-id: your_tbaas_secret_id
    secret-key: your_tbaas_secret_key
    # 地域配置
    region: ap-beijing
    # 网络配置
    cluster-id: your_cluster_id
    chain-id: your_chain_id
    contract-name: cropseed-trace
    # 超时配置（毫秒）- 增加超时时间以应对网络波动
    timeout: 120000
    # 重试配置
    retry:
      max-attempts: 3  # 最多重试3次
      delay: 2000      # 重试间隔2秒

# 支付宝沙箱配置（请填写您的支付宝应用信息）
pay:
  alipay:
    # 应用 ID
    app-id: 9021000141610286
    # 应用私钥
    private-key: your_alipay_private_key
    # 支付宝公钥
    alipay-public-key: your_alipay_public_key
    # 支付宝网关
    server-url: https://openapi-sandbox.dl.alipaydev.com/gateway.do
    # 同步通知 URL - 修正为您的前端页面
    return-url: http://your-domain.com/api/payment/alipay/return
    # 异步通知 URL（需要外网可访问）
    notify-url: http://your-domain.com/api/payment/alipay/notify
    # 字符集
    charset: UTF-8
    # 签名类型，通常是 RSA2
    sign-type: RSA2

# JWT配置（请修改为您自己的密钥）
jwt:
  # 密钥（请在生产环境修改为复杂的密钥）
  secret: cropseed-trace-system-jwt-secret-key-2025-for-production
  # Token有效期（秒） 7天
  expiration: 604800
  # Token前缀
  tokenPrefix: Bearer
  # Token请求头名称
  tokenHeader: Authorization

# 日志配置
logging:
  level:
    root: INFO
    com.cropseed: INFO
  file:
    name: /app/logs/cropseed-trace.log
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n'
    file: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n'
  logback:
    rollingpolicy:
      max-file-size: 100MB
      max-history: 30
      total-size-cap: 10GB

# 监控端点配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized
  health:
    defaults:
      enabled: true

# 微信小程序配置（请填写您的微信小程序信息）
wx:
  app-id: your_wechat_appid
  app-secret: your_wechat_secret
  pay:
    mch-id: your_merchant_id
    key: your_merchant_key
    notify-url: http://your-domain.com/api/wechat/pay/notify
    cert-path: /path/to/cert.p12

# 推荐系统配置
recommendation:
  # 相似度阈值
  similarity-threshold: 0.1
  # 时间衰减天数
  time-decay-days: 30
  # 最近购买天数
  recent-purchase-days: 30
  # 行为权重配置
  behavior-weight:
    view: 1.0
    search: 1.5
    collect: 3.0
    cart: 3.5
    purchase: 5.0
    rate: 4.0
  # 混合推荐权重配置
  hybrid-weight:
    collaborative: 0.30
    content: 0.25
    personalized: 0.25
    popular: 0.20
  # 用户相似度权重配置
  similarity-weight:
    behavior: 0.7
    profile: 0.3
  # 降权配置
  downgrade:
    enabled: true
    recent-purchase-ratio: 0.3
